# æ•°æ®å¤§å±å¼€å‘æŒ‡å—

## ğŸ“š å¯¼èˆª

[â† å‰ç«¯å¼€å‘æŒ‡å—](./03-å‰ç«¯å¼€å‘æŒ‡å—.md) | [å¸¸è§é—®é¢˜FAQ â†’](./05-å¸¸è§é—®é¢˜FAQ.md)

---

## ğŸ¯ æ•°æ®å¤§å±æ¦‚è¿°

æ•°æ®å¤§å±æ˜¯ NO-CRM çš„æ•°æ®å¯è§†åŒ–ä¸­å¿ƒï¼Œä½¿ç”¨ Echarts å›¾è¡¨åº“å±•ç¤ºå„ç±»ç»Ÿè®¡æ•°æ®ï¼Œå¸®åŠ©ç®¡ç†è€…ä¸€ç›®äº†ç„¶åœ°äº†è§£ä¸šåŠ¡æƒ…å†µã€‚

### ä¸»è¦åŠŸèƒ½

- ğŸ“Š **ç»Ÿè®¡å¡ç‰‡**ï¼šå¿«é€ŸæŸ¥çœ‹æ ¸å¿ƒæŒ‡æ ‡
- ğŸ“ˆ **è¶‹åŠ¿å›¾**ï¼šæœ€è¿‘7å¤©æ•°æ®å˜åŒ–
- ğŸ¥§ **åˆ†å¸ƒå›¾**ï¼šçº¿ç´¢é˜¶æ®µã€ä»»åŠ¡ä¼˜å…ˆçº§ç­‰åˆ†å¸ƒ
- ğŸ¯ **é›·è¾¾å›¾**ï¼šè·Ÿè¿›æ–¹å¼å¤šç»´åº¦å¯¹æ¯”

---

## ğŸ“Š Echarts åŸºç¡€

### å®‰è£…ä¸å¼•å…¥

```bash
# å®‰è£… Echarts
npm install echarts
```

```typescript
// åœ¨ç»„ä»¶ä¸­å¼•å…¥
import * as echarts from 'echarts'
```

### åŸºæœ¬ä½¿ç”¨æµç¨‹

```typescript
// 1. å‡†å¤‡ DOM å®¹å™¨
const chartRef = ref<HTMLElement>()

// 2. åˆå§‹åŒ–å›¾è¡¨å®ä¾‹
let chart: echarts.ECharts | null = null

onMounted(() => {
  if (chartRef.value) {
    chart = echarts.init(chartRef.value)
  }
})

// 3. è®¾ç½®é…ç½®é¡¹
chart.setOption({
  title: { text: 'ç¤ºä¾‹å›¾è¡¨' },
  xAxis: { type: 'category', data: ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰'] },
  yAxis: { type: 'value' },
  series: [{
    type: 'line',
    data: [120, 200, 150]
  }]
})

// 4. æ¸…ç†
onUnmounted(() => {
  chart?.dispose()
})
```

---

## ğŸ“ˆ å›¾è¡¨ç±»å‹è¯¦è§£

### 1. æŠ˜çº¿å›¾ï¼ˆLine Chartï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šå±•ç¤ºæ•°æ®éšæ—¶é—´çš„å˜åŒ–è¶‹åŠ¿

```typescript
const option = {
  tooltip: {
    trigger: 'axis'
  },
  legend: {
    data: ['å®¢æˆ·', 'çº¿ç´¢']
  },
  xAxis: {
    type: 'category',
    data: ['11/3', '11/4', '11/5', '11/6', '11/7', '11/8', '11/9']
  },
  yAxis: {
    type: 'value'
  },
  series: [
    {
      name: 'å®¢æˆ·',
      type: 'line',
      smooth: true,  // å¹³æ»‘æ›²çº¿
      data: [5, 8, 12, 9, 15, 18, 20],
      itemStyle: { color: '#667eea' },
      // åŒºåŸŸå¡«å……
      areaStyle: {
        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
          { offset: 0, color: 'rgba(102, 126, 234, 0.3)' },
          { offset: 1, color: 'rgba(102, 126, 234, 0.05)' }
        ])
      }
    },
    {
      name: 'çº¿ç´¢',
      type: 'line',
      smooth: true,
      data: [10, 15, 18, 14, 22, 25, 28],
      itemStyle: { color: '#f5576c' },
      areaStyle: {
        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
          { offset: 0, color: 'rgba(245, 87, 108, 0.3)' },
          { offset: 1, color: 'rgba(245, 87, 108, 0.05)' }
        ])
      }
    }
  ]
}
```

### 2. é¥¼å›¾ï¼ˆPie Chartï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šå±•ç¤ºå æ¯”å…³ç³»

```typescript
const option = {
  tooltip: {
    trigger: 'item',
    formatter: '{b}: {c} ({d}%)'  // æ˜¾ç¤ºåç§°ã€æ•°å€¼ã€ç™¾åˆ†æ¯”
  },
  legend: {
    orient: 'vertical',
    right: 10,
    top: 'center'
  },
  series: [
    {
      type: 'pie',
      radius: ['40%', '70%'],  // å†…å¤–åŠå¾„ï¼Œç¯å½¢å›¾
      center: ['40%', '50%'],   // åœ†å¿ƒä½ç½®
      data: [
        { name: 'æœªè·Ÿè¿›', value: 10 },
        { name: 'è·Ÿè¿›ä¸­', value: 25 },
        { name: 'å·²åˆæ ¼', value: 15 },
        { name: 'å·²æˆäº¤', value: 30 },
        { name: 'æ— æ•ˆ', value: 5 }
      ],
      emphasis: {
        itemStyle: {
          shadowBlur: 10,
          shadowOffsetX: 0,
          shadowColor: 'rgba(0, 0, 0, 0.5)'
        }
      },
      label: {
        formatter: '{b}\n{d}%'  // æ ‡ç­¾æ ¼å¼
      }
    }
  ],
  color: ['#5470c6', '#91cc75', '#fac858', '#ee6666', '#73c0de']
}
```

### 3. æŸ±çŠ¶å›¾ï¼ˆBar Chartï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šå¯¹æ¯”ä¸åŒç±»åˆ«çš„æ•°å€¼

```typescript
const option = {
  tooltip: {
    trigger: 'axis',
    axisPointer: { type: 'shadow' }
  },
  xAxis: {
    type: 'category',
    data: ['ä½', 'ä¸­', 'é«˜']
  },
  yAxis: {
    type: 'value'
  },
  series: [
    {
      type: 'bar',
      data: [
        {
          value: 10,
          itemStyle: {
            // æ¸å˜è‰²
            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
              { offset: 0, color: '#4facfe' },
              { offset: 1, color: '#00f2fe' }
            ])
          }
        },
        { value: 25, itemStyle: { /* ... */ } },
        { value: 8, itemStyle: { /* ... */ } }
      ],
      barWidth: '60%'  // æŸ±å­å®½åº¦
    }
  ]
}
```

### 4. é›·è¾¾å›¾ï¼ˆRadar Chartï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šå¤šç»´åº¦æ•°æ®å¯¹æ¯”

```typescript
const option = {
  tooltip: {
    trigger: 'item'
  },
  radar: {
    indicator: [
      { name: 'ç”µè¯', max: 50 },
      { name: 'é‚®ä»¶', max: 50 },
      { name: 'ä¼šè®®', max: 50 },
      { name: 'å…¶ä»–', max: 50 }
    ],
    radius: '60%',
    center: ['50%', '50%']
  },
  series: [
    {
      type: 'radar',
      data: [
        {
          value: [30, 20, 15, 10],
          name: 'è·Ÿè¿›æ–¹å¼',
          areaStyle: {
            color: new echarts.graphic.RadialGradient(0.5, 0.5, 1, [
              { offset: 0, color: 'rgba(67, 233, 123, 0.3)' },
              { offset: 1, color: 'rgba(56, 249, 215, 0.1)' }
            ])
          },
          lineStyle: {
            color: '#43e97b'
          }
        }
      ]
    }
  ]
}
```

---

## ğŸ¨ æ•°æ®å¤§å±å®ç°

### å®Œæ•´ç¤ºä¾‹

```vue
<template>
  <div class="dashboard-page">
    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <div class="stats-cards">
      <div class="stat-card" v-for="stat in statsCards" :key="stat.label">
        <div class="stat-icon" :style="{ background: stat.color }">
          <t-icon :name="stat.icon" size="32px" />
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ stat.value }}</div>
          <div class="stat-label">{{ stat.label }}</div>
        </div>
      </div>
    </div>

    <!-- å›¾è¡¨åŒºåŸŸ -->
    <div class="charts-container">
      <div class="chart-card">
        <h3>æœ€è¿‘7å¤©è¶‹åŠ¿</h3>
        <div ref="trendChartRef" class="chart-content"></div>
      </div>

      <div class="chart-card">
        <h3>çº¿ç´¢é˜¶æ®µåˆ†å¸ƒ</h3>
        <div ref="pieChartRef" class="chart-content"></div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, onUnmounted } from 'vue'
import * as echarts from 'echarts'
import { statisticsApi } from '@/api/statistics'

// ç»Ÿè®¡å¡ç‰‡æ•°æ®
const statsCards = ref([
  {
    icon: 'user',
    label: 'å®¢æˆ·æ€»æ•°',
    value: 0,
    color: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
  },
  // ... å…¶ä»–å¡ç‰‡
])

// å›¾è¡¨å¼•ç”¨
const trendChartRef = ref<HTMLElement>()
const pieChartRef = ref<HTMLElement>()

let trendChart: echarts.ECharts | null = null
let pieChart: echarts.ECharts | null = null

// åŠ è½½æ•°æ®
const loadData = async () => {
  const data = await statisticsApi.getOverview()
  
  // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
  statsCards.value[0].value = data.totalCustomers
  
  // åˆå§‹åŒ–å›¾è¡¨
  initCharts(data)
}

// åˆå§‹åŒ–å›¾è¡¨
const initCharts = (data: any) => {
  // è¶‹åŠ¿å›¾
  if (trendChartRef.value) {
    if (trendChart) trendChart.dispose()
    trendChart = echarts.init(trendChartRef.value)
    
    trendChart.setOption({
      xAxis: {
        type: 'category',
        data: data.recentTrend.map((t: any) => t.date)
      },
      yAxis: { type: 'value' },
      series: [
        {
          name: 'å®¢æˆ·',
          type: 'line',
          data: data.recentTrend.map((t: any) => t.customers)
        }
      ]
    })
  }

  // é¥¼å›¾
  if (pieChartRef.value) {
    if (pieChart) pieChart.dispose()
    pieChart = echarts.init(pieChartRef.value)
    
    pieChart.setOption({
      series: [{
        type: 'pie',
        data: data.leadsByStage.map((item: any) => ({
          name: item.stage,
          value: item.count
        }))
      }]
    })
  }
}

// å“åº”å¼è°ƒæ•´
const handleResize = () => {
  trendChart?.resize()
  pieChart?.resize()
}

onMounted(() => {
  loadData()
  window.addEventListener('resize', handleResize)
})

onUnmounted(() => {
  window.removeEventListener('resize', handleResize)
  trendChart?.dispose()
  pieChart?.dispose()
})
</script>

<style scoped>
.chart-content {
  height: 300px;
}
</style>
```

---

## ğŸ“Š æ•°æ®ç»Ÿè®¡å®ç°

### ç»Ÿè®¡æ¥å£

```typescript
// api/statistics.ts
export const statisticsApi = {
  async getOverview() {
    // å¹¶è¡Œè¯·æ±‚æ‰€æœ‰æ•°æ®
    const [customers, leads, activities, tasks] = await Promise.all([
      api.get('/customers'),
      api.get('/leads'),
      api.get('/activities'),
      api.get('/tasks')
    ])

    return {
      totalCustomers: customers.length,
      totalLeads: leads.length,
      totalActivities: activities.length,
      totalTasks: tasks.length,
      
      // ç»Ÿè®¡åˆ†å¸ƒ
      leadsByStage: this.countByField(leads, 'stage'),
      tasksByPriority: this.countByField(tasks, 'priority'),
      
      // è®¡ç®—è¶‹åŠ¿
      recentTrend: this.calculateTrend(customers, leads)
    }
  },

  // æŒ‰å­—æ®µç»Ÿè®¡
  countByField(data: any[], field: string) {
    const counts: Record<string, number> = {}
    data.forEach(item => {
      const value = item[field] || 'unknown'
      counts[value] = (counts[value] || 0) + 1
    })
    return Object.entries(counts).map(([key, count]) => ({
      [field]: key,
      count
    }))
  },

  // è®¡ç®—æœ€è¿‘7å¤©è¶‹åŠ¿
  calculateTrend(customers: any[], leads: any[]) {
    const last7Days = []
    const today = new Date()
    
    for (let i = 6; i >= 0; i--) {
      const date = new Date(today)
      date.setDate(date.getDate() - i)
      const dateStr = date.toISOString().split('T')[0]
      
      const customersCount = customers.filter(c => 
        c.createdAt.startsWith(dateStr)
      ).length
      
      const leadsCount = leads.filter(l => 
        l.createdAt.startsWith(dateStr)
      ).length
      
      last7Days.push({
        date: `${date.getMonth() + 1}/${date.getDate()}`,
        customers: customersCount,
        leads: leadsCount
      })
    }
    
    return last7Days
  }
}
```

---

## ğŸ¨ æ ·å¼è®¾è®¡

### ç»Ÿè®¡å¡ç‰‡

```css
.stats-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 24px;
}

.stat-card {
  background: #fff;
  border-radius: 12px;
  padding: 24px;
  display: flex;
  align-items: center;
  gap: 20px;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
  transition: all 0.3s ease;
  animation: fadeInUp 0.5s ease-out;
}

.stat-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
}

.stat-icon {
  width: 64px;
  height: 64px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
}

.stat-value {
  font-size: 32px;
  font-weight: 700;
  color: #1a1a1a;
}

.stat-label {
  font-size: 14px;
  color: #666;
}
```

### å›¾è¡¨å¡ç‰‡

```css
.chart-card {
  background: #fff;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
}

.chart-content {
  height: 300px;
  width: 100%;
}
```

### åŠ¨ç”»æ•ˆæœ

```css
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
```

---

## ğŸ¯ å¸¸ç”¨é…ç½®é¡¹

### å…¨å±€é…ç½®

```typescript
const option = {
  // æ ‡é¢˜
  title: {
    text: 'ä¸»æ ‡é¢˜',
    subtext: 'å‰¯æ ‡é¢˜',
    left: 'center'
  },
  
  // å·¥å…·æç¤º
  tooltip: {
    trigger: 'axis',  // 'item', 'axis', 'none'
    formatter: '{b}: {c} ({d}%)'
  },
  
  // å›¾ä¾‹
  legend: {
    data: ['ç³»åˆ—1', 'ç³»åˆ—2'],
    top: 10,
    left: 'center'
  },
  
  // ç½‘æ ¼ï¼ˆå›¾è¡¨ä½ç½®ï¼‰
  grid: {
    left: '3%',
    right: '4%',
    bottom: '3%',
    top: '15%',
    containLabel: true  // åŒ…å«æ ‡ç­¾
  },
  
  // é¢œè‰²
  color: ['#5470c6', '#91cc75', '#fac858']
}
```

### åæ ‡è½´

```typescript
{
  xAxis: {
    type: 'category',  // 'value', 'category', 'time', 'log'
    data: ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰'],
    axisLine: {
      lineStyle: { color: '#999' }
    },
    axisTick: {
      show: false  // éšè—åˆ»åº¦çº¿
    }
  },
  
  yAxis: {
    type: 'value',
    axisLine: {
      lineStyle: { color: '#999' }
    },
    splitLine: {
      lineStyle: { color: '#f0f0f0' }
    }
  }
}
```

### ç³»åˆ—æ ·å¼

```typescript
{
  series: [{
    type: 'line',  // å›¾è¡¨ç±»å‹
    name: 'é”€é‡',
    data: [120, 200, 150],
    
    // çº¿æ¡æ ·å¼
    lineStyle: {
      color: '#5470c6',
      width: 2
    },
    
    // ç‚¹æ ·å¼
    itemStyle: {
      color: '#5470c6',
      borderColor: '#fff',
      borderWidth: 2
    },
    
    // æ ‡ç­¾
    label: {
      show: true,
      position: 'top',
      formatter: '{c}'
    },
    
    // åŒºåŸŸå¡«å……
    areaStyle: {
      opacity: 0.3
    }
  }]
}
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. å›¾è¡¨å“åº”å¼

```typescript
// ç›‘å¬çª—å£å¤§å°å˜åŒ–
const handleResize = () => {
  chart?.resize()
}

onMounted(() => {
  window.addEventListener('resize', handleResize)
})

onUnmounted(() => {
  window.removeEventListener('resize', handleResize)
})
```

### 2. å†…å­˜ç®¡ç†

```typescript
// ç»„ä»¶é”€æ¯æ—¶æ¸…ç†å›¾è¡¨å®ä¾‹
onUnmounted(() => {
  chart?.dispose()
  chart = null
})
```

### 3. æ•°æ®æ›´æ–°

```typescript
// ä½¿ç”¨ notMerge å®Œå…¨æ›¿æ¢é…ç½®
chart.setOption(newOption, { notMerge: true })

// å¢é‡æ›´æ–°ï¼ˆæ¨èï¼‰
chart.setOption(newOption)
```

### 4. æ€§èƒ½ä¼˜åŒ–

```typescript
// å¤§æ•°æ®é‡ä½¿ç”¨é‡‡æ ·
series: [{
  type: 'line',
  data: bigData,
  sampling: 'average'  // é‡‡æ ·ç­–ç•¥
}]

// æ‡’åŠ è½½
series: [{
  type: 'line',
  large: true,  // å¼€å¯å¤§æ•°æ®ä¼˜åŒ–
  largeThreshold: 2000  // é˜ˆå€¼
}]
```

### 5. ä¸»é¢˜å®šåˆ¶

```typescript
// æ³¨å†Œè‡ªå®šä¹‰ä¸»é¢˜
echarts.registerTheme('custom', {
  color: ['#667eea', '#f5576c', '#4facfe'],
  backgroundColor: '#f5f5f5'
})

// ä½¿ç”¨ä¸»é¢˜
const chart = echarts.init(dom, 'custom')
```

---

## ğŸ› å¸¸è§é—®é¢˜

### 1. å›¾è¡¨ä¸æ˜¾ç¤º

**åŸå› **ï¼šå®¹å™¨é«˜åº¦ä¸º 0

**è§£å†³**ï¼š
```css
.chart-content {
  height: 300px;  /* å¿…é¡»è®¾ç½®é«˜åº¦ */
}
```

### 2. å“åº”å¼ä¸ç”Ÿæ•ˆ

**åŸå› **ï¼šæœªè°ƒç”¨ resize

**è§£å†³**ï¼š
```typescript
window.addEventListener('resize', () => {
  chart?.resize()
})
```

### 3. æ•°æ®æ›´æ–°åå›¾è¡¨ä¸å˜

**åŸå› **ï¼šæœªé‡æ–° setOption

**è§£å†³**ï¼š
```typescript
watch(data, (newData) => {
  chart.setOption({
    series: [{ data: newData }]
  })
})
```

### 4. å†…å­˜æ³„æ¼

**åŸå› **ï¼šæœªé”€æ¯å›¾è¡¨å®ä¾‹

**è§£å†³**ï¼š
```typescript
onUnmounted(() => {
  chart?.dispose()
})
```

---

## ğŸ“š å­¦ä¹ èµ„æº

- [Echarts å®˜æ–¹æ–‡æ¡£](https://echarts.apache.org/zh/index.html)
- [Echarts ç¤ºä¾‹](https://echarts.apache.org/examples/zh/index.html)
- [é…ç½®é¡¹æ‰‹å†Œ](https://echarts.apache.org/zh/option.html)

---

## ğŸ”— ä¸‹ä¸€æ­¥

- æŸ¥çœ‹ [å¸¸è§é—®é¢˜FAQ](./05-å¸¸è§é—®é¢˜FAQ.md)
- è¿”å› [å‰ç«¯å¼€å‘æŒ‡å—](./03-å‰ç«¯å¼€å‘æŒ‡å—.md)
- è¿”å› [é¡¹ç›®æ¦‚è§ˆ](./01-é¡¹ç›®æ¦‚è§ˆ.md)
